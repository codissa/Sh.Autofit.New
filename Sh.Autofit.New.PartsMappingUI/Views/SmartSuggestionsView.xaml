<UserControl x:Class="Sh.Autofit.New.PartsMappingUI.Views.SmartSuggestionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="1400"
             FlowDirection="RightToLeft">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Loading Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="4"
               Background="#80000000"
               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
               Panel.ZIndex="1000">
            <Border Background="White"
                   CornerRadius="8"
                   Padding="30"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="â³" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                    <TextBlock Text="{Binding StatusMessage}"
                              FontSize="14"
                              FontWeight="SemiBold"
                              HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Border>

        <!-- Title and Actions -->
        <Grid Grid.Row="0" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="×”×¦×¢×•×ª ×—×›×ž×•×ª"
                          FontSize="24"
                          FontWeight="Bold"/>
                <TextBlock Text="×ž×¢×¨×›×ª ×ž×¦×™×¢×” ×ž×™×¤×•×™×™× ×—×“×©×™× ×¢×œ ×¡×ž×š ×ž×™×¤×•×™×™× ×§×™×™×ž×™×"
                          FontSize="12"
                          Foreground="Gray"
                          Margin="0,5,0,0"/>
            </StackPanel>

            <Button Grid.Column="1"
                   Content="ðŸ”„ ×¨×¢× ×Ÿ ×”×¦×¢×•×ª"
                   Command="{Binding LoadSuggestionsCommand}"
                   Padding="15,8"
                   FontSize="14"
                   Background="#4CAF50"
                   Foreground="White"
                   BorderThickness="0"
                   Cursor="Hand"/>
        </Grid>

        <!-- Statistics Panel -->
        <Border Grid.Row="1"
               Background="#F5F5F5"
               CornerRadius="8"
               Padding="15"
               Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="×¡×”×´×› ×”×¦×¢×•×ª" FontSize="11" Foreground="Gray"/>
                    <TextBlock Text="{Binding TotalSuggestions}" FontSize="24" FontWeight="Bold" Foreground="#2196F3"/>
                </StackPanel>

                <StackPanel Grid.Column="1">
                    <TextBlock Text="×‘×™×˜×—×•×Ÿ ×’×‘×•×” (90+)" FontSize="11" Foreground="Gray"/>
                    <TextBlock Text="{Binding HighConfidenceSuggestions}" FontSize="24" FontWeight="Bold" Foreground="#4CAF50"/>
                </StackPanel>

                <StackPanel Grid.Column="2">
                    <TextBlock Text="×‘×™×˜×—×•×Ÿ ×‘×™× ×•× ×™ (70-89)" FontSize="11" Foreground="Gray"/>
                    <TextBlock Text="{Binding MediumConfidenceSuggestions}" FontSize="24" FontWeight="Bold" Foreground="#FF9800"/>
                </StackPanel>

                <StackPanel Grid.Column="3">
                    <TextBlock Text="×¨×›×‘×™× ×¤×•×˜× ×¦×™××œ×™×™×" FontSize="11" Foreground="Gray"/>
                    <TextBlock Text="{Binding PotentialVehicles}" FontSize="24" FontWeight="Bold" Foreground="#9C27B0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Filters and Bulk Actions -->
        <Grid Grid.Row="2" Margin="0,0,0,15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Filters Row -->
            <Grid Grid.Row="0" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Padding="8"
                         Margin="0,0,10,0">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <VisualBrush Stretch="None" AlignmentX="Right">
                                                <VisualBrush.Visual>
                                                    <TextBlock Text="ðŸ” ×—×¤×© ×—×œ×§ ××• ×“×’×..."
                                                              Foreground="Gray"
                                                              Margin="0,0,5,0"
                                                              FlowDirection="RightToLeft"/>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <ComboBox Grid.Column="1"
                         ItemsSource="{Binding AvailableManufacturers}"
                         SelectedItem="{Binding SelectedManufacturer}"
                         Width="150"
                         Padding="8"
                         Margin="0,0,10,0"/>

                <ComboBox Grid.Column="2"
                         ItemsSource="{Binding AvailableCategories}"
                         SelectedItem="{Binding SelectedCategory}"
                         Width="150"
                         Padding="8"
                         Margin="0,0,10,0"/>

                <TextBox Grid.Column="3"
                        Text="{Binding MinScore}"
                        Width="80"
                        Padding="8"
                        Margin="0,0,10,0"
                        ToolTip="×¦×™×•×Ÿ ×ž×™× ×™×ž×œ×™"/>

                <CheckBox Grid.Column="4"
                         Content="×¨×§ ×‘×™×˜×—×•×Ÿ ×’×‘×•×”"
                         IsChecked="{Binding ShowOnlyHighConfidence}"
                         VerticalAlignment="Center"
                         Padding="5"/>
            </Grid>

            <!-- Bulk Actions Row -->
            <StackPanel Grid.Row="1" Orientation="Horizontal">
                <TextBlock Text="×¤×¢×•×œ×•×ª ×§×‘×•×¦×ª×™×•×ª:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <Button Content="××©×¨ 10 ×”×¨××©×•× ×•×ª"
                       Command="{Binding AcceptTopNCommand}"
                       Padding="10,5"
                       Margin="0,0,5,0"
                       Background="#2196F3"
                       Foreground="White"
                       BorderThickness="0"
                       Cursor="Hand">
                    <Button.CommandParameter>
                        <sys:Int32>10</sys:Int32>
                    </Button.CommandParameter>
                </Button>
                <Button Content="××©×¨ ×›×œ ×”×‘×™×˜×—×•×Ÿ ×”×’×‘×•×”"
                       Command="{Binding AcceptAllHighConfidenceCommand}"
                       Padding="10,5"
                       Background="#4CAF50"
                       Foreground="White"
                       BorderThickness="0"
                       Cursor="Hand"/>
            </StackPanel>
        </Grid>

        <!-- Suggestions List (Card View) -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding FilteredSuggestions}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#E0E0E0"
                               BorderThickness="1"
                               CornerRadius="8"
                               Padding="15"
                               Margin="0,0,0,15"
                               Background="White">
                            <Border.Effect>
                                <DropShadowEffect Color="Gray" BlurRadius="5" ShadowDepth="2" Opacity="0.2"/>
                            </Border.Effect>

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Header: Score and Confidence -->
                                <Grid Grid.Row="0" Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <TextBlock Text="{Binding ConfidenceIcon}"
                                                  FontSize="20"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,5,0"/>
                                        <TextBlock Text="×¦×™×•×Ÿ: " FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Score, StringFormat={}{0:F0}}"
                                                  FontSize="18"
                                                  FontWeight="Bold"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,10,0"/>
                                        <TextBlock Text="|" Foreground="Gray" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <TextBlock Text="×‘×™×˜×—×•×Ÿ: " FontSize="14" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding ConfidenceText}"
                                                  FontSize="14"
                                                  FontWeight="SemiBold"
                                                  VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Part Information -->
                                <StackPanel Grid.Row="1" Margin="0,0,0,10">
                                    <TextBlock Text="×—×œ×§:" FontSize="11" Foreground="Gray"/>
                                    <TextBlock FontSize="16" FontWeight="SemiBold">
                                        <Run Text="{Binding PartNumber}"/>
                                        <Run Text=" - "/>
                                        <Run Text="{Binding PartName}"/>
                                    </TextBlock>
                                    <TextBlock Text="{Binding Category}"
                                              FontSize="12"
                                              Foreground="Gray"
                                              Margin="0,2,0,0"/>
                                </StackPanel>

                                <!-- Source Model -->
                                <StackPanel Grid.Row="2" Margin="0,0,0,10">
                                    <TextBlock Text="×ž:" FontSize="11" Foreground="Gray"/>
                                    <TextBlock Text="{Binding SourceModelDisplay}"
                                              FontSize="13"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                        <TextBlock Text="×ž×ž×•×¤×” ×›×¨×’×¢ ×œ: " FontSize="11" Foreground="Gray"/>
                                        <TextBlock Text="{Binding SourceVehicleCount}" FontSize="11" FontWeight="SemiBold"/>
                                        <TextBlock Text=" ×¨×›×‘×™×" FontSize="11" Foreground="Gray" Margin="0,0,10,0"/>
                                        <TextBlock Text="| ×ž×©×ž×©: " FontSize="11" Foreground="Gray"/>
                                        <TextBlock Text="{Binding OtherModelsWithPart}" FontSize="11" FontWeight="SemiBold"/>
                                        <TextBlock Text=" ×“×’×ž×™× × ×•×¡×¤×™×" FontSize="11" Foreground="Gray"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Target Models -->
                                <StackPanel Grid.Row="3" Margin="0,0,0,10">
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="×ž×•×¦×¢ ×œ:" FontSize="11" Foreground="Gray"/>
                                            <TextBlock Text="{Binding TargetModelsDisplay}"
                                                      FontSize="13"
                                                      FontWeight="SemiBold"
                                                      Margin="0,2,0,0"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Bottom">
                                            <Button Content="×‘×—×¨ ×”×›×œ"
                                                   Click="SelectAllTargets_Click"
                                                   Tag="{Binding}"
                                                   Padding="5,2"
                                                   FontSize="10"
                                                   Margin="0,0,5,0"
                                                   Background="Transparent"
                                                   BorderBrush="#2196F3"
                                                   BorderThickness="1"
                                                   Foreground="#2196F3"
                                                   Cursor="Hand"/>
                                            <Button Content="×‘×˜×œ ×”×›×œ"
                                                   Click="DeselectAllTargets_Click"
                                                   Tag="{Binding}"
                                                   Padding="5,2"
                                                   FontSize="10"
                                                   Background="Transparent"
                                                   BorderBrush="#FF9800"
                                                   BorderThickness="1"
                                                   Foreground="#FF9800"
                                                   Cursor="Hand"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Target Models List -->
                                    <ItemsControl ItemsSource="{Binding TargetModels}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#F5F5F5"
                                                        CornerRadius="4"
                                                        Padding="8,4"
                                                        Margin="5,2,0,2"
                                                        BorderBrush="#E0E0E0"
                                                        BorderThickness="1">
                                                    <CheckBox IsChecked="{Binding IsSelected}"
                                                              Content="{Binding DisplayName}"
                                                              FontSize="12"
                                                              VerticalAlignment="Center"/>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Score Reason -->
                                    <TextBlock Text="{Binding ScoreReason}"
                                              FontSize="11"
                                              FontStyle="Italic"
                                              Foreground="Gray"
                                              Margin="0,5,0,0"
                                              TextWrapping="Wrap"/>
                                </StackPanel>

                                <!-- Action Buttons -->
                                <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="âœ“ ××©×¨ ×“×’×ž×™× × ×‘×—×¨×™×"
                                           Command="{Binding DataContext.AcceptSuggestionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                           CommandParameter="{Binding}"
                                           Padding="15,8"
                                           Margin="0,0,10,0"
                                           Background="#4CAF50"
                                           Foreground="White"
                                           BorderThickness="0"
                                           FontWeight="SemiBold"
                                           Cursor="Hand"
                                           ToolTip="×ž×¤×” ××ª ×”×—×œ×§ ×œ×“×’×ž×™× ×©×¡×•×ž× ×• ×œ×ž×¢×œ×”"/>
                                    <Button Content="âœ— ×“×—×”"
                                           Command="{Binding DataContext.RejectSuggestionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                           CommandParameter="{Binding}"
                                           Padding="15,8"
                                           Background="#F44336"
                                           Foreground="White"
                                           BorderThickness="0"
                                           Cursor="Hand"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
